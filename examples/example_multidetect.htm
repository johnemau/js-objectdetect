<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	
	<script src="js/compatibility.js"></script>
	<script src="js/smoother.js"></script>
	
	<script src="js/objectdetect.js"></script>
	<script src="js/objectdetect.frontalface.js"></script>
	<script src="js/objectdetect.handfist.js"></script>
	<script src="js/objectdetect.eye.js"></script>
	
	<script src="http://code.jquery.com/jquery-1.8.0.min.js"></script>
	<script src="js/jquery.objectdetect.js"></script>

	<script src="../node_modules/underscore/underscore.js"></script>
	<script src="../src/objectdetect.js"></script>
	
	<script>
	var smoother = new Smoother(0.85, [0, 0, 0, 0, 0]);
		
	$(window).load(function() {
	
		var video = $("#video").get(0);
		try {
			compatibility.getUserMedia({video: true}, function(stream) {
				try {
					video.src = compatibility.URL.createObjectURL(stream);
				} catch (error) {
					video.src = stream;
				}
				video.play();
				compatibility.requestAnimationFrame(tick);
			}, function (error) {
				alert("WebRTC not available");
			});
		} catch (error) {
			alert(error);
		}

		var ee = new EagleEye(video, ['frontalface', 'eye'], {
            frontalface: 1,
            eye: 1/3
        });
	
		function getBox(index, type) {
			var $box = $("#box-" + index);
			// try to get existing box
			if($box.length > 0) {
				return $box;	
			} else {
				//add new box
				var $newbox = $('<div id="box-' + index + '" class="' + type + ' box">');
				$("#faceboxbox").append($newbox);
				return $newbox;
			}
		}

		function tick() {
			compatibility.requestAnimationFrame(tick);
			
			if (video.readyState === video.HAVE_ENOUGH_DATA) {
				ee.detect({scaleMin: 3, scaleFactor: 1.1}, function(allcoords) {
					$("#faceboxbox").empty();
					$.each(allcoords, function(index, coordObj) {
						var coords = smoother.smooth(coordObj.data);
						getBox(index, coordObj.type).css({
							"left":    ~~(coords[0] + coords[2] * 1.0/8 + $(video).offset().left) + "px",
							"top":     ~~(coords[1] + coords[3] * 0.8/8 + $(video).offset().top) + "px",
							"width":   ~~(coords[2] * 6/8) + "px",
							"height":  ~~(coords[3] * 6/8) + "px",
							"display": "block"
						});
					});
				});
			}
		}
	});
	
    </script>
    <style type="text/css">
	.box {
	  position: absolute;
	  border-style: solid;
	  border-width: medium;
	}
	.frontalface {
	  border-color: red;
	}
	.eye {
	  border-color: blue;
	}
    </style>
</head>

<body>
    <h1>Face and Eye Detect</h1>
    <video id="video"></video>
    <div id="faceboxbox"></div>
</body>
</html>
